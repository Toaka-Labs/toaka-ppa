name: Update ubuntu/24/arm64 PPA

on:
    workflow_dispatch:
    push:
        paths:
            - ubuntu/24/arm64/**

jobs:
    update-ppa-ubuntu-24-arm64:
        runs-on: ubuntu-latest
        permissions:
            contents: write
        steps:
            -
              name: Checkout
              uses: actions/checkout@v4
              with:
                fetch-depth: 0
            -
              name: Import GPG Signing Key
              run: |
                echo -n "$GPG_SIGNING_KEY" | base64 --decode | gpg --import
              env:
                GPG_SIGNING_KEY: ${{ secrets.GPG_SIGNING_KEY }}
            -
              name: Update PPA Details
              run: |
                cd ubuntu/24/arm64
                rm -f Packages; dpkg-scanpackages --multiversion . > Packages
                rm -f Packages.gz; gzip -k -f Packages
                rm -f Release; apt-ftparchive release . > Release
                rm -f Release.gpg; gpg -abs -o - Release > Release.gpg
                rm -f InRelease; gpg --clearsign -o - Release > InRelease
            -
              name: Commit Updates
              run: |
                git config --local user.email "github-actions[bot]@users.noreply.github.com"
                git config --local user.name "github-actions[bot]"
                git add ubuntu/24/arm64/*
                git commit -m "AUTOMATED PPA FILE UPDATE"
            -
              name: Push Updates
              uses: ad-m/github-push-action@master
              with:
                github_token: ${{ secrets.GITHUB_TOKEN }}
                branch: ${{ github.ref }}
